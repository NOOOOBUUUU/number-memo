<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>記録付きボタン</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  font-family: sans-serif;
}

:root { --base-font: 16px; }
body { font-size: var(--base-font); }

.container { width: 100%; }

.record {
  width: 100%;
  min-height: 10em;
  border: 1px solid #333;
  padding: 8px;
  box-sizing: border-box;
  white-space: pre-wrap;
  word-break: break-all;
}

.grid {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
}

button {
  aspect-ratio: 1 / 1;
  font-size: 1em;
  border: 1px solid #333;
  background: #f0f0f0;
  cursor: pointer;
}

button.yellow { background: #ffd966; }
button.red { background: #ff6666; }
button.tab-used { background: #ffd966; }
button.active-tab { outline: 3px solid #333; }

.controls {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
}
</style>
</head>
<body>

<div class="container">

  <div id="record" class="record"></div>

  <div id="tabs" class="grid"></div>

  <div class="controls">
    <button onclick="renameTab()">タブ名変更</button>
    <button onclick="undo()">戻る</button>
    <button onclick="copyRecord()">コピー</button>
    <button onclick="addUnknown()">不明</button>
    <button onclick="changeFont()">文字サイズ</button>
    <button disabled></button><button disabled></button>
    <button disabled></button><button disabled></button>
    <button disabled></button>
  </div>

  <div id="numbers" class="grid"></div>

</div>

<script>
const recordDiv = document.getElementById("record");

let tabs = Array.from({length:10}, (_,i)=>({
  name: `${i+1}組`,
  counts: {},
  used: false
}));

let currentTab = 0;
let recordText = "";
let history = [];
let fontState = 0;
let lastInputTab = null;

function snapshot() {
  return {
    recordText,
    counts: JSON.parse(JSON.stringify(tabs.map(t=>t.counts))),
    used: tabs.map(t=>t.used),
    currentTab,
    lastInputTab
  };
}

function restore(s) {
  recordText = s.recordText;
  tabs.forEach((t,i)=>{
    t.counts = s.counts[i];
    t.used = s.used[i];
  });
  currentTab = s.currentTab;
  lastInputTab = s.lastInputTab;
}

function writeTabHeaderIfNeeded() {
  if (lastInputTab === null) {
    recordText += `${tabs[currentTab].name}: `;
  } else if (lastInputTab !== currentTab) {
    recordText += `\n${tabs[currentTab].name}: `;
  }
}

function pressNumber(key) {
  history.push(snapshot());

  writeTabHeaderIfNeeded();

  const tab = tabs[currentTab];
  tab.used = true;
  tab.counts[key] = (tab.counts[key]||0)+1;

  const c = tab.counts[key];
  recordText += c >= 2 ? `${key}(${c}), ` : `${key}, `;

  lastInputTab = currentTab;
  render();
}

function addUnknown() {
  history.push(snapshot());
  writeTabHeaderIfNeeded();
  recordText += "?, ";
  lastInputTab = currentTab;
  render();
}

function switchTab(i) {
  if (i === currentTab) return;
  currentTab = i;
  render();
}

function undo() {
  const last = history.pop();
  if (!last) return;
  restore(last);
  render();
}

function renameTab() {
  const name = prompt("新しいタブ名（3文字以内）");
  if (!name || name.length > 3) return;
  tabs[currentTab].name = name;
  render();
}

function copyRecord() {
  navigator.clipboard.writeText(recordText);
}

function changeFont() {
  fontState = (fontState + 1) % 3;
  document.documentElement.style.setProperty(
    "--base-font",
    fontState === 0 ? "16px" :
    fontState === 1 ? "24px" : "32px"
  );
}

function renderTabs() {
  const t = document.getElementById("tabs");
  t.innerHTML = "";
  tabs.forEach((tab,i)=>{
    const b = document.createElement("button");
    b.textContent = tab.name;
    if (i === currentTab) b.classList.add("active-tab");
    if (tab.used) b.classList.add("tab-used");
    b.onclick = ()=>switchTab(i);
    t.appendChild(b);
  });
}

function renderNumbers() {
  const n = document.getElementById("numbers");
  n.innerHTML = "";
  for (let i=1;i<=40;i++) {
    const key = String(i).padStart(2,"0");
    const b = document.createElement("button");
    b.textContent = key;
    const c = tabs[currentTab].counts[key] || 0;
    if (c >= 2) b.classList.add("red");
    else if (c === 1) b.classList.add("yellow");
    b.onclick = ()=>pressNumber(key);
    n.appendChild(b);
  }
}

function render() {
  renderTabs();
  renderNumbers();
  recordDiv.textContent = recordText;
}

render();
</script>

</body>
</html>
