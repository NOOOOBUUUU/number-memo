<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>番号記録ツール</title>

<style>
:root {
  --scale: 1;
}

body {
  margin: 0;
  padding: 8px;
  font-family: sans-serif;
  font-size: calc(16px * var(--scale));
}

.row {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 4px;
  margin-bottom: 6px;
}

button {
  aspect-ratio: 1 / 1;
  font-size: 1em;
}

/* 記録欄 */
textarea {
  width: 100%;
  resize: none;
  font-size: 1em;
  line-height: 1.4;
  white-space: pre-wrap;
  word-break: break-all;
}

/* 色 */
.tab-active { background: #2196f3; color: #fff; }
.tab-used { background: #ffeb3b; }

.btn-yellow { background: #ffeb3b; }
.btn-red { background: #f44336; color: #fff; }
</style>
</head>

<body>

<!-- タブ -->
<div class="row" id="tabs"></div>

<!-- 記録 -->
<textarea id="record" readonly></textarea>

<!-- ボタン -->
<div class="row" id="buttons"></div>

<script>
/* ===== 状態 ===== */
let tabs = Array.from({length:10}, (_,i)=>`${i+1}組`);
let currentTab = 0;
let lastInputTab = null;

let counts = Array.from({length:10}, ()=>Array(46).fill(0));
let history = [];

let snapshots = [];

let fontIndex = 0;
const fontScales = [1, 1.5, 2];

/* ===== 描画 ===== */
function renderTabs() {
  const el = document.getElementById("tabs");
  el.innerHTML = "";

  tabs.forEach((name,i)=>{
    const b = document.createElement("button");
    b.textContent = name;

    if (i === currentTab) {
      b.classList.add("tab-active");
    } else if (counts[i].some(v=>v>0)) {
      b.classList.add("tab-used");
    }

    b.onclick = ()=>selectTab(i);
    el.appendChild(b);
  });
}

function renderButtons() {
  const el = document.getElementById("buttons");
  el.innerHTML = "";

  for (let i=1;i<=45;i++) {
    const b = document.createElement("button");
    b.textContent = String(i).padStart(2,"0");

    const c = counts[currentTab][i];
    if (c === 1) b.classList.add("btn-yellow");
    if (c >= 2) b.classList.add("btn-red");

    b.onclick = ()=>pressNumber(i);
    el.appendChild(b);
  }

  addBtn("戻る", undo);
  addBtn("不明", addUnknown);
  addBtn("コピー", copyRecord);
  addBtn("タブ名変更", renameTab);
  addBtn("文字サイズ", changeFont);
}

function addBtn(label, fn) {
  const b = document.createElement("button");
  b.textContent = label;
  b.onclick = fn;
  document.getElementById("buttons").appendChild(b);
}

function updateRecord() {
  const r = document.getElementById("record");
  r.value = history.join("");
  r.style.height = "auto";
  r.style.height = r.scrollHeight + "px";
}

/* ===== 操作 ===== */
function selectTab(i) {
  currentTab = i;
  renderTabs();
  renderButtons();
}

function saveSnapshot() {
  snapshots.push({
    counts: JSON.parse(JSON.stringify(counts)),
    history: [...history],
    lastInputTab
  });
}

function pressNumber(n) {
  saveSnapshot();

  if (lastInputTab !== currentTab) {
    if (lastInputTab !== null) history.push("\n");
    history.push(`${tabs[currentTab]}: `);
    lastInputTab = currentTab;
  }

  counts[currentTab][n]++;
  const c = counts[currentTab][n];

  history.push(
    c===1
      ? `${String(n).padStart(2,"0")}, `
      : `${String(n).padStart(2,"0")}(${c}), `
  );

  renderTabs();
  renderButtons();
  updateRecord();
}

function addUnknown() {
  saveSnapshot();

  if (lastInputTab !== currentTab) {
    if (lastInputTab !== null) history.push("\n");
    history.push(`${tabs[currentTab]}: `);
    lastInputTab = currentTab;
  }

  history.push("?, ");
  renderTabs();
  renderButtons();
  updateRecord();
}

function undo() {
  if (!snapshots.length) return;
  const s = snapshots.pop();
  counts = JSON.parse(JSON.stringify(s.counts));
  history = [...s.history];
  lastInputTab = s.lastInputTab;

  renderTabs();
  renderButtons();
  updateRecord();
}

function copyRecord() {
  navigator.clipboard.writeText(document.getElementById("record").value);
}

function renameTab() {
  const n = prompt("新しいタブ名（3文字まで）", tabs[currentTab]);
  if (n && n.length<=3) {
    tabs[currentTab] = n;
    renderTabs();
  }
}

function changeFont() {
  fontIndex = (fontIndex+1)%3;
  document.documentElement.style.setProperty("--scale", fontScales[fontIndex]);
}

/* 初期化 */
renderTabs();
renderButtons();
</script>

</body>
</html>
